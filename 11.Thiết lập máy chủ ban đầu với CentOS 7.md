# Thiết lập máy chủ ban đầu với CentOS 7
## Thiết lập cơ bản
### Bước 1: đăng nhập gốc
```
#ssh root@SERVER_IP_ADDRESS
```
### Bước 2: Tạo người dùng mới
```
#useradd vitap
#passwd vitap
```
### Bước 3 : Đặc quyền gốc
```
#gpasswd -a vitap wheel
````
- Khi thêm vào nhóm wheel tài khoản vitap được hưởng  quyền "siêu người dùng" hoặc đặc quyền root cho tài khoản thông thường . Điều này sẽ cho phép chạy các lệnh có đặc quyền quản trị bằng cách đặt từ `sudo` trước mỗi lệnh.
### Bước 4 : thêm xác thực khoá công khai
#### 4.1 tạo một cặp khoá

```
ssh-keygen
```

```
ssh-keygen output
Generating public/private rsa key pair.
Enter file in which to save the key (/Users/localuser/.ssh/id_rsa):
```
- Khoá sẽ được lưu tại đường dẫn. Quá trình trên tạo ra một khóa riêng tư `id_rsa` và một khóa công khai `id_rsa.pub` trong `.ssh` thư mục của thư mục chính của người dùng cục bộ. 
#### 4.2 Gửi thông tin khoá
```
ssh-copy-id demo@SERVER_IP_ADDRESS
```
- Cài đặt khoá theo cách thủ công
```
cat ~/.ssh/id_rsa.pub 
```
  - Khoá công khai có dạng
```
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcxuYVHrrJO6YCp3GyofoBACrqF8aas31q+6v/75w5psvqlbpg2BlPTV2X7yhuT0DBaru5A9KaOcAG1CkvizPaVCeBPhEwXnyXHrghRd7XvaphT1uhbLtJoGsRia1tB5iD76/yXcLrwbFkBk1/hvN8WyNU56nwZO/oCuZaS964eW0A+ZtTEiOoTGqtNJP1UPpiQ8Ji7eAlZj9K9z3MGLICBXyCqtNKbON021z+95DshtDMKKa+b1Tp5WxYkDzhlHezabUFG9Rpv1OaOlw8puUOxWNakSy8xVfrBU8jKnuKFo+LXKHUdoCNv5K+U/Uz3hd9bGePtj/+VjaLr9PX01AJ phamthientrang@MacBook-Air-cua-PHAM.local

```
- Thêm khoá công khai cho người dùng từ xa: đăng nhập
```
su - vitap
```
- tạo thư mục mới để chứa khoá, phân quyền cho thư mục
```
mkdir .ssh
chmod 700 .ssh
```

- Copy khoá công khai vào thư mục nhờ trình soạn tho vi
```
vi .ssh/authorized_keys
```
- Uỷ quyền cho thư mục
```
chmod 600 .ssh/authorized_keys
```
- hoàn thành, thoát:
```
exit
```

### 5. Cấu hình SSH Daemon
- vào file config để chỉnh sửa dịch vụ ssh
```
vi /etc/ssh/sshd_config
```
- Vô hiệu hoá đăng nhập root từ xa
```
#PermitRootLogin yes
```
```
PermitRootLogin no
```
- Restart lại dịch vụ
```
systemctl reload sshd
```
- Đăng nhập bằng tài khoản user 
```
ssh vitap@SERVER_IP_ADDRESS
```
- Lưu ý để chạy đặng quyền root với user cần phải thêm `sudo trước câu lênh`
```
sudo command_to_run
```
